#!/bin/sh
# SCRIPTS_DIR/bin/xfce4-power-manager
# <=xfpm-1.2.0 seg faults with translations, change locale if appropriate.

[ -h "${0}" ] &&
    script_p="$(readlink -f "${0}")" ||
    script_p="${0}"
lib_d="${script_p%/*/*}/lib"
. "${lib_d}/notify.sh"
verbose=true
. "${lib_d}/prog.sh"

xfpm="$(get_prog $(command which -a "${0##*/}"))"

xfpm_version="$(${xfpm} --version 2>&1 | \
    sed -ne '{
	y:XFCEPOWRMANG:xfcepowrmang:
	s:^\s*xfce4\?\s\+power\s\+manager\s\+\([0-9\.]\+\)\s*$:\1:p
    }')"
[ -n "${xfpm_version}" ] ||
    die "Cannot get XfPM version."

xfpm_major="${xfpm_version%%.*}"
xfpm_minor="${xfpm_version%.*}"
xfpm_minor="${xfpm_minor#*.}"
xfpm_patch="${xfpm_version##*.}"

[ ${xfpm_major} -eq 1 -a ${xfpm_minor} -le 2 -a ${xfpm_patch} -le 0 ] &&
    export LANG='C' ||
    warn "Wrapping a potentially unaffected" "XfPM version"

exec ${xfpm} "${@}"
